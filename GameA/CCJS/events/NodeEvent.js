define(function(m,q){var h=this,e=m("../core/Logger").getLog(),n=m("../core/Event.js"),r=m("../utils/wrapper"),g=n.getInstance("NodeEvent"),j={isActive:{TYPE:"SFBool",NOE:"isActive",SCE:"x3d_active",EXIST:!0},isOver:{TYPE:"SFBool",NOE:"isOver",SCE:"x3d_over",EXIST:!0},hitNormal:{TYPE:"SFVec3f",NOE:"hitNormal_changed",SCE:"x3d_hitNormal",EXIST:!0},hitPoint:{TYPE:"SFVec3f",NOE:"hitPoint_changed",SCE:"x3d_hitPoint",EXIST:!0},hitTexCoord:{TYPE:"SFVec2f",NOE:"hitTexCoord_changed",SCE:"x3d_hitTexCoord",
EXIST:!0},translation:{TYPE:"SFVec3f",NOE:"translation",SCE:"x3d_translation",EXIST:!0},rotation:{TYPE:"SFRotation",NOE:"rotation",SCE:"x3d_rotation",EXIST:!0},scale:{TYPE:"SFVec3f",NOE:"scale",SCE:"x3d_scale",EXIST:!0}},k={},n=h+"",p;for(p in j){var b=j[p];RegExp("eventIn\\s"+b.TYPE+"\\s"+b.SCE).test(n)?h[b.SCE]=function(e){return function(c){var f=getEmitter(),a,d;(a=f.getName())?g.trigger(a+":"+e,c,f):(d=thisNode(f))&&(a=d.getName())&&g.trigger(a+":"+e,c,f,d)}}(p):(e.warn("加载NodeEvent错误: Script脚本中，未找到正确配置 eventIn "+
b.TYPE+" "+b.SCE+" 的 eventIn"),b.EXIST=!1)}q.bind=function(b,c,f){var a=j[c];a?r(b).forEach(function(d){var l=SFNode.get(d);l?a.EXIST?(k[l.getName()+":"+a.NOE]||(SFNode.createRoute(l,a.NOE,h,a.SCE),k[l.getName()+":"+a.NOE]=!0),g.bind(d+":"+c,f),e.debug('NodeEvent 节点 "'+d+'" 绑定事件 "'+c+'" 成功')):e.warn('NodeEvent 节点 "'+d+'" 绑定事件 "'+c+'" 失败,未找到入事件 "'+a.SCE+'" 的定义'):e.warn('NodeEvent 绑定事件 "'+c+'" 时发生错误,未找到结点 "'+d+'"')}):e.warn('NodeEvent 不支持的事件类型: "'+c+'"')};q.unBind=function(b,c,f){var a=j[c];a?r(b).forEach(function(d){var b=
SFNode.get(d);b?(g.unbind(d+":"+c,f),0==g.getEventBinds(c)&&k[b.getName()+":"+a.NOE]&&(SFNode.removeRoute(b,a.NOE,h,a.SCE),k[b.getName()+":"+a.NOE]=!1)):e.warn('NodeEvent 解除绑定事件 "'+c+'" 时发生错误,未找到结点 "'+d+'"')}):e.warn('NodeEvent 不支持的事件类型: "'+c+'"')}});
